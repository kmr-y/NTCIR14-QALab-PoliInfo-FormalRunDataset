# （2019/01/23更新）結果公開と評価

## 評価スクリプトの使用方法
### 各スクリプトファイルの説明
* poliinfo_createGS_formal_classification.py
    * トピックごとに複数あるtestGSファイルを評価スクリプト用に一つにまとめます．
* poliinfo_eval_formal_classification.py
    * 上記スクリプトで作成したファイルを用いて，推定結果の自動評価を行います．

### 評価までの手順
1. 各トピックのtestGSファイルを評価用に適した形式に変換する

    　　　　```
    　　　　python3 poliinfo_createGS_formal_classification.py -i testGS/Classification-2018-JA-FormalRun-Test-02-カジノを含む統合型リゾートを推進するべきである-365-* > new_gs.json
    　　　　```

1. 上記で作成したデータを用いて，結果データを評価する．

    ```
    python3 poliinfo_eval_formal_classification.py -a new_gs.json -o output_directory -i input_file1 [input_file2 ...]
    ```

    * ```-o```オプションで指定したディレクトリにはインスタンスごとの結果と混同行列表が出力されます．
    * 標準出力には```-i```オプションで指定したすべての入力データの総合評価結果が出力されます．

Formal Runの提出データと評価結果を本リポジトリで公開しています．
各ディレクトリ，ファイルの内容は以下の通りです．

* ```evals```ディレクトリ（各トピック番号のサブディレクトリがあります）
    * ```ConfusionMatrix-Classification-2018-JA-FormalRun-Test-[TOPIC]_[GROUP_ID]-[PRIORITY].txt```
        * ```[GROUP_ID]```の```[PRIORITY]```提出における混同行列表をタブ区切りテキスト形式で表したものです．
        * 各行が正解，各列が提出結果の出力値を表しています．
            * 行における```10```, ```20```は，正解がそれぞれ```1```と```0```，```2```と```0```両方あることを表します．
            * 行における```-```は，正解が存在しないことを表します．この行に対応するインスタンスは評価値の計算対象から除外されます．
        * Classificationタスクでは正解のみなし方が複数あるため，表もその分の数だけあります．
            * 正解のみなし方の名前は，各表の1行目部分，```正解[正解のみなし方名]```（例：正解N1）に記載があります．各正解のみなし方は後述します．
    * ```Result-Classification-2018-JA-FormalRun-Test-[TOPIC]_[GROUP_ID]-[PRIORITY].txt```
        * ```[GROUP_ID]```の```[PRIORITY]```提出における各インスタンスの正誤結果をタブ区切りテキスト形式で表したものです．
* ```submits```ディレクトリ（各トピック番号のサブディレクトリがあります）
    * 本タスクにて提出されたすべてのAnswerSheetデータを配置しています．
* ```eval-Classification-2018-JA-Formal-[TOPIC_NUM].xlsx```
    * ```[TOPIC_NUM]```のトピックにおける全提出データを対象とした評価結果一覧です．
    * 各列は```[正解のみなし方]_[評価対象]_[評価指標]```という形式です．
        * ```Acc```: Accuracy
        * ```P[i]```: ラベル```i```におけるPrecision
        * ```R[i]```: ラベル```i```におけるRecall

## 略語の意味
* 正解のみなし方
    * ```[アルファベット1文字]```: アルファベットは作成者IDを表す．その作成者による成果情報を用いたGold Standard．
    * ```N1```: 作成者が1人でも付与したラベルを正解とみなす．
    * ```N2```: 作成者が2人以上付与したラベルを正解とみなす．
    * ```N3```: 作成者が3人以上付与したラベルを正解とみなす．3人以上付与したラベルがない場合は正解なしとして，評価対象から除外する．
    * ```SC```: 作成者が何人付与したかを正解スコアの重みとして用いる，（例えば，```0```が2名，```1```が1名の場合，出力```0```に対しては2点，出力```1```に対しては1点という評価をする）
* 評価対象
    * ```Rl```: Relevance
    * ```FC```: Fact-checkability
    * ```St```: Stance
    * ```Cl```: Class


# Formal Run提出データの書式チェッカースクリプトについて

Formal Run提出データ（Answer Sheet）の書式をチェックするPythonスクリプトです．
結果を提出する際は，本スクリプトによるチェックをパスしたファイルを提出してください．

## 動作環境

* Python 3.5以上
    * Windows, macOS, Linux環境で動作確認済み

## 使用方法

```bash
python3 poliinfo_check_format2.py [-h] -t {seg,sum,cls} json_file
```

* 必須引数:
    * ```json_file```: 対象JSONファイル（指定しない場合は標準入力から読み込みます）
    * ```-t {seg,sum,cls}, --type {seg,sum,cls}```: 対象ファイルの種別を指定し
        * (```seg```:Segmentation, ```sum```:Summarization, ```cls```:Classification)
* オプション引数:
    * ```-h, --help```: ヘルプ表示
  
| 実行結果 | 意味 |
|:--------|:----|
| チェックOK | 書式チェックをすべてパスしたことを表します． |
| [JSON全体の文法性] ...エラーあり | ファイルがJSONの書式を満たしていないことを表します．エラーの内容と箇所も併せて表示されます． |
| 先頭行は "[" のみでなければなりません． | 本提出データの先頭行は ```[``` のみとしてください． |
| 末尾行は "]" のみでなければなりません． | 本提出データの末尾行は ```]``` のみとしてください． |
| [line *n*] エラー，行が1つのオブジェクトになっていません． | （ファイルの*n*行目について）1行につき1つのオブジェクト表記としてください． |
| [line *n*] エラー，出力値 "xxx" が必要です． | （ファイルの*n*行目について）出力値として必須である ```xxx``` 項目が欠如しています． |
| [line *n*] エラー，識別子 "ID" が必要です． | （ファイルの*n*行目について）識別子として必須である ```ID``` 項目が欠如しています． |
| [line *n*] すでに出力済みの識別子を持つ行です． | （ファイルの*n*行目について）このIDのインスタンスは以前の行で出力済みです． |
| [line *n*] エラー，同名のフィールドが複数存在します．． | （ファイルの*n*行目について）同名の項目が2つ以上存在してはいけません． |